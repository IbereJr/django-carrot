language: python

python:
  - "3.6"

before_install:
  - pip install poetry

install:
  - poetry install

script:
  - coverage run run_tests.py

after_success:
  - coveralls

before_deploy:
  - poetry config repositories.packagr https://api.packagr.app/63cdQSDO/
  - poetry config http-basic.packagr "christopherdavies553@gmail.com" $PACKAGR_PASSWORD
  - poetry config http-basic.pypi chris140957 $PACKAGR_PASSWORD
  - poetry build

deploy:
  - provider: script
    script: poetry publish
    on:
      tags: true

  - provider: script
    script: poetry publish -r packagr
    on:
      condition: "1 == 1"
env:
  - DJANGO_VERSION=2.1
